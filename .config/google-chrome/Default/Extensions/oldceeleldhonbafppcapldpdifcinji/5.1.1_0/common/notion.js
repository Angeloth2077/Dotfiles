/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var _a;class Notion{static _isEditableElement(t){return!(t.matches(this.UNEDITABLE_ELEMENT_SELECTOR)&&!this._hasEditableElements(t))}static _isInEditableElement(t){let e=t;do{if(e.matches(this.EDITABLE_ELEMENT_SELECTOR))return!0;if(e.matches(this.UNEDITABLE_ELEMENT_SELECTOR))return!1;e=e.parentElement}while(e);return!1}static _hasEditableElements(t){let e=Array.from(t.querySelectorAll(this.EDITABLE_ELEMENT_SELECTOR));return e=e.filter((t=>!this._isCommentInput(t))),!!e.length}static _isMainFrameElement(t){return t.matches(this.MAIN_FRAME_SELECTOR)}static _isPreviewWindowElement(t){return t.matches(this.PREVIEW_WINDOW_SELECTOR)}static _isEditorPart(t){return(t.matches(this.CONTENT_EDITABLE_ROOT_SELECTOR)||t.matches(this.BLOCK_ELEMENT_SELECTOR))&&!this._isInCommentDialog(t)}static _isInCommentDialog(t){return!!closestElement(t,this.COMMENT_DIALOG_SELECTOR)}static _isCommentInput(t){return(t.getAttribute("placeholder")||"").includes("comment")}static _getScrollElement(t){if(!this._scrollElements.has(t)){const e=t.querySelector(this.SCROLLER_SELECTOR);this._scrollElements.set(t,e||t)}return this._scrollElements.get(t)}static _getEditor(t){return t?this._isEditorPart(t)?closestElement(t,this.MAIN_FRAME_SELECTOR)||closestElement(t,this.PREVIEW_WINDOW_SELECTOR):null:document.querySelector(this.MAIN_FRAME_SELECTOR)}static _turnOnSpellcheck(t){if(!this._turnOffedElements.has(t))return;const e=this._turnOffedElements.get(t);for(const t of e)t.setAttribute("spellcheck","true")}static _turnOffSpellcheck(t){this._turnOffedElements.has(t)||this._turnOffedElements.set(t,new Set);const e=this._turnOffedElements.get(t),i=Array.from(t.querySelectorAll(this.SPELLCHECKED_ELEMENT_SELECTOR));for(const t of i)e.has(t)||this._isInCommentDialog(t)||(t.setAttribute("spellcheck","false"),e.add(t))}static _onInputAreaMutation(t,e){if(!this._isMainFrameElement(t))return;if(e.some((e=>e.target===t&&e.addedNodes.length>0))){const e=this._destroyCallbacks.get(t);e&&e(t)}else this._turnOffSpellcheck(t)}static isCommentEditor(t){return t.matches(this.COMMENT_EDITOR_SELECTOR)}static isEditorLeaf(t){return t.matches(this.EDITOR_LEAF_SELECTOR)}static isEditor(t){return this._isMainFrameElement(t)||this._isPreviewWindowElement(t)}static getInitElements(t){let e=this._getEditor(t);return e?[e]:this.isEditorLeaf(t)?(e=this._getEditor(),e?[e,t]:[t]):[t]}static initInputArea(t){this._turnOffSpellcheck(t);const e=new MutationObserver((e=>this._onInputAreaMutation(t,e)));this._mutationObservers.set(t,e),e.observe(t,Notion.INPUT_AREA_MUTATION_OBSERVER_OPTIONS)}static destroyInputArea(t){this._scrollElements.delete(t),this._turnOnSpellcheck(t),this._turnOffedElements.delete(t);const e=this._mutationObservers.get(t);e&&(e.disconnect(),this._mutationObservers.delete(t)),this._destroyCallbacks.delete(t)}static onInputAreaDestroy(t,e){this._destroyCallbacks.set(t,e)}static createMutationObserver(t){return new FilteringMutationObserver(t,this._isMutationIgnored)}static isElementIgnored(t,e){const i=t.tagName.toUpperCase();return!!CEElementInspector.SKIPPING_TAGS.includes(i)||("none"===e.display||("BLOCKQUOTE"===i||(!!t.matches(this.COMMENT_DIALOG_SELECTOR)||(!!t.matches(this.CODE_BLOCK_SELECTOR)||(!!t.matches(this.BUTTON_SELECTOR)||(!this._isEditableElement(t)||!("SUP"!==i||!t.textContent)&&CEElementInspector.SUP_REGEXP.test(t.textContent.trim())))))))}static getCacheInvalidationRules(t){return Object.assign({},t,{isSkippingElement:{self:{attributes:[],childList:!0},parent:{childList:!0},ancestor:{attributes:["id","class","style"]},descendant:{attributes:["id","class","style","contenteditable"],characterData:!0,childList:!0},sibling:{attributes:["id"]}},replacementText:{self:{attributes:["id","class","style","contenteditable","spellcheck","role"],childList:!0},ancestor:{attributes:["id","class","style","contenteditable"]},descendant:{characterData:!0,childList:!0}}})}static getHighlighterTargetElement(t){return this._getScrollElement(t)}static addHighlighterScrollEventListener(t,e){this._getScrollElement(t).addEventListener("scroll",e)}static removeHighlighterScrollEventListener(t,e){this._getScrollElement(t).removeEventListener("scroll",e)}static getHighlighterVisibleBox(t,e){return e.getPaddingBox(t,!0,!1)}static getHighlighterScrollableElementSize(t,e){const i=this._getScrollElement(t);return e.getScrollDimensions(i,!1)}static getHighlighterScrollPosition(t,e,i,n){const s=this._getScrollElement(t);return e.getScrollPosition(s,i,n)}static getToolbarParent(t){return this._isMainFrameElement(t)?this._getScrollElement(t):t.parentElement}static getToolbarPosition(t,e,i,n,s){const o=t.ownerDocument.documentElement.clientHeight,r=i.getScaleFactor(e),E=i.getZoom(e),l=r.x*E,a=r.y*E;if(this._isMainFrameElement(t)){const e=t.querySelector(this.PAGE_LAST_BLOCK_SELECTOR)||t.querySelector(this.PAGE_HEADER_SELECTOR);if(!e)return null;const r=i.getBorderBox(e,!1);let E=n?r.left/l+6:r.right/l-6-s.width;if(r.bottom>o)return{fixed:!0,left:Math.round(E)+"px"};let c=r.bottom/a-6-s.height;const _=document.querySelector(this.TOPBAR_SELECTOR);if(_){c-=i.getBorderBox(_).height}c+=this._getScrollElement(t).scrollTop;const d=document.querySelector(this.SIDEBAR_SELECTOR);if(d){E-=i.getBorderBox(d).width}return{fixed:!1,left:Math.round(E)+"px",top:Math.round(c)+"px"}}if(this._isPreviewWindowElement(t)){const e=10,r=i.getBorderBox(t,!1),E=n?r.left/l+6+e:r.right/l-6-e-s.width;if(r.bottom>o)return{fixed:!0,left:Math.round(E)+"px"};const c=r.bottom/a-6-s.height;return{fixed:!1,left:Math.round(E)+"px",top:Math.round(c)+"px"}}return null}}_a=Notion,Notion.UNEDITABLE_ELEMENT_SELECTOR="[contenteditable='false']",Notion.EDITABLE_ELEMENT_SELECTOR="[contenteditable='true']",Notion.MAIN_FRAME_SELECTOR="div.notion-frame",Notion.PREVIEW_WINDOW_SELECTOR="div.notion-peek-renderer > div[style*='display: flex']",Notion.CONTENT_EDITABLE_ROOT_SELECTOR="[data-content-editable-root][contenteditable=true]",Notion.BLOCK_ELEMENT_SELECTOR="div.notranslate[contenteditable='true']",Notion.COMMENT_EDITOR_SELECTOR="div.notion-discussion-input div",Notion.EDITOR_LEAF_SELECTOR="div.notion-overlay-container div[contenteditable=true][data-content-editable-leaf=true]",Notion.COMMENT_DIALOG_SELECTOR="div.notion-margin-discussion-item, div.notion-page-view-discussion",Notion.SCROLLER_SELECTOR="div.notion-scroller",Notion.CODE_BLOCK_SELECTOR="div.notion-code-block:not(.notion-selectable)",Notion.BUTTON_SELECTOR="[role='button']",Notion.SPELLCHECKED_ELEMENT_SELECTOR="[spellcheck='true']",Notion.PAGE_CONTROLS_SELECTOR="div.notion-frame div.notion-page-controls",Notion.SELECTION_HALO_SELECTOR="div.notion-selectable-halo",Notion.ICON_SELECTOR="div.notion-record-icon",Notion.PAGE_HEADER_SELECTOR="div.notion-scroller div.notion-page-block div[contenteditable='true']",Notion.PAGE_LAST_BLOCK_SELECTOR="div.notion-page-content > div.notion-selectable:not(.notion-divider-block):last-child",Notion.TOPBAR_SELECTOR="div.notion-app-inner div.notion-topbar",Notion.SIDEBAR_SELECTOR="div.notion-cursor-listener > div.notion-sidebar-container:first-child",Notion.INPUT_AREA_MUTATION_OBSERVER_OPTIONS={attributes:!1,characterData:!1,childList:!0,subtree:!0},Notion._scrollElements=new Map,Notion._turnOffedElements=new Map,Notion._mutationObservers=new Map,Notion._destroyCallbacks=new Map,Notion._isMutationIgnored=t=>{const e=isElementNode(t.target)?t.target:t.target.parentElement;return!!e&&(!closestElement(e,_a.SCROLLER_SELECTOR)||(!!closestElement(e,_a.COMMENT_DIALOG_SELECTOR)||(!!closestElement(e,_a.CODE_BLOCK_SELECTOR)||(!!closestElement(e,_a.PAGE_CONTROLS_SELECTOR)||("attributes"===t.type&&!_a._isInEditableElement(e)||(!("attributes"!==t.type||!e.matches(_a.SELECTION_HALO_SELECTOR))||(!("attributes"!==t.type||!e.matches(_a.ICON_SELECTOR))||"attributes"===t.type&&"placeholder"===t.attributeName)))))))},window.__ltThunderbirdHack=1;
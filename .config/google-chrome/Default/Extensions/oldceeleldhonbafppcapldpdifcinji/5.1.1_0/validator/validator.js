/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
{const t=document.getElementById("status-box"),e=document.getElementById("status-headline"),a=document.getElementById("status-text"),s=document.getElementById("status-button"),r=document.getElementById("text-field");let n=!1,o=null;const i=StorageController.create();function initText(){const t=new URL(window.location.href).searchParams.get("id");if(t){const e={command:"GET_VALIDATOR_DATA",id:t};browser.runtime.sendMessage(e).then((t=>{t&&isGetValidatorDataResult(t)&&(t.text&&(r.innerText=t.text),history.replaceState({},"",location.pathname))})).catch((()=>{Tracker.trackError("js","validator_failed","promise")})).then((()=>{Tracker.trackPageView()}))}else r.innerText=localStorage.getItem("validator-text")||"",Tracker.trackPageView()}function onLTAssistantStateUpdated(s){n||(n=!0,t.setAttribute("data-initialized","true"));const r=s.detail;if(JSON.stringify(r)===JSON.stringify(o))return;const{hasPaidSubscription:d}=i.getUIState();o=r;const l=r.checkStatus;t.className="validator__status-box",l===CHECK_STATUS.TEXT_TOO_SHORT?(t.classList.add("validator__status-box--no-errors"),e.textContent=i18nManager.getMessage("validatorNoTextStatus"),a.textContent=""):l===CHECK_STATUS.TEXT_TOO_LONG?(d?(t.classList.add("validator__status-box--has-exception"),a.textContent=""):(t.classList.add("validator__status-box--has-premium-errors"),a.textContent=i18nManager.getMessage("dialogTextTooLongText")),e.textContent=i18nManager.getMessage("validatorTextTooLongStatus")):l===CHECK_STATUS.IN_PROGRESS?(t.classList.add("validator__status-box--in-progress"),e.textContent=i18nManager.getMessage("validatorLoadingHint"),a.textContent=""):l===CHECK_STATUS.COMPLETED?r.displayedErrors&&r.displayedErrors.length?(t.classList.add("validator__status-box--has-errors"),e.textContent=1===r.displayedErrors.length?i18nManager.getMessage("validatorHasMistakesHeadlineSingular"):i18nManager.getMessage("validatorHasMistakesHeadlinePlural",[r.displayedErrors.length]),a.textContent=i18nManager.getMessage("validatorHasMistakesText")):r.premiumErrors&&r.premiumErrors.length?(t.classList.add("validator__status-box--has-premium-errors"),e.textContent=1===r.premiumErrors.length?i18nManager.getMessage("validatorHasPremiumErrorsHeadlineSingular"):i18nManager.getMessage("validatorHasPremiumErrorsHeadlinePlural",[r.premiumErrors.length]),a.textContent=i18nManager.getMessage("validatorHasPremiumErrorsText")):(t.classList.add("validator__status-box--no-errors"),e.textContent=i18nManager.getMessage("validatorNoMistakesHeadline"),a.textContent=""):l===CHECK_STATUS.UNSUPPORTED_LANGUAGE?(t.classList.add("validator__status-box--has-exception"),e.textContent=i18nManager.getMessage("dialogUnsupportedLanguageHeadline"),a.textContent=i18nManager.getMessage("dialogUnsupportedLanguageText")):l===CHECK_STATUS.FAILED&&r.errorMessage?(a.textContent="",e.textContent=r.errorMessage,t.classList.add("validator__status-box--has-exception")):(a.textContent="",e.textContent=i18nManager.getMessage("statusIconError"),t.classList.add("validator__status-box--has-exception"))}function onStatusButtonClick(){if(!o)return;let t="https://languagetool.org/premium?pk_campaign=addon2-validator-premium-errors";t+=`&grammarMatches=${o.premiumErrors.filter((t=>!t.isStyleError)).length}`,t+=`&styleMatches=${o.premiumErrors.filter((t=>t.isStyleError)).length}`,window.open(t,"_target")}function onBeforeUnload(){localStorage.setItem("validator-text",r.innerText)}i.onReady((()=>{i.getUIState().hasPaidSubscription||i.hasCustomServer()||document.getElementById("sidebar").classList.remove("validator__sidebar--collapsed"),i.startChangelogCoupon();const t=i.getActiveCoupon();t&&(document.querySelector("#validator-upgrade-button").textContent=i18nManager.getMessage("upgradeTeaserDiscount",[t.percent])),initText()})),translateSection(document.documentElement),r.addEventListener(LTAssistant.events.UPDATE,onLTAssistantStateUpdated),s.addEventListener("click",onStatusButtonClick),window.addEventListener("beforeunload",onBeforeUnload),r.focus()}
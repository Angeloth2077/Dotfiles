/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class ExtensionEnvironmentAdapter extends EnvironmentAdapterClass{constructor(){super(...arguments),this._isProductionEnvironmentCached=null}isProductionEnvironment(){if(null===this._isProductionEnvironmentCached){if(BrowserDetector.isSafari())return!0;BrowserDetector.isFirefox()||BrowserDetector.isThunderbird()?this._isProductionEnvironmentCached=!browser.runtime.id.match("languagetool.dev"):this._isProductionEnvironmentCached="update_url"in browser.runtime.getManifest()}return this._isProductionEnvironmentCached}isRuntimeConnected(){try{return browser.runtime.getManifest(),!0}catch(e){return!1}}getVersion(){if(this.isRuntimeConnected()){const e=browser.runtime.getManifest();return e&&e.version?e.version:"unknown"}return"unknown"}getTrackingId(){return BrowserDetector.isSafari()?"13":BrowserDetector.isThunderbird()?"22":"12"}shouldTrack(){return"1"!==navigator.doNotTrack}getType(){return"extension"}getURL(e){return browser.runtime.getURL(e)}getUILanguageCode(){return browser.i18n.getUILanguage()}openWindow(e){browser.runtime.sendMessage({command:"OPEN_URL",url:e})}loadContentScripts(e,n){return this.isRuntimeConnected()?(browser.runtime.getManifest().content_scripts.forEach((r=>{if("js"===n&&r.js){const n=r.js.map((e=>{const n=this.getURL(e);return fetch(n).then((e=>e.text()))}));return Promise.all(n).then((n=>{const r=n.join("\n");e.eval(r)}))}if("css"===n&&r.css){const n=r.css.map((e=>{const n=this.getURL(e);return fetch(n).then((e=>e.text()))}));return Promise.all(n).then((n=>{n.forEach((n=>{const r=e.document.createElement("style");r.textContent=n,(e.document.head||e.document.documentElement).appendChild(r)}))}))}})),Promise.resolve()):Promise.reject()}initializeLTAssistant(e,n={}){return Promise.resolve()}getPreferredLanguages(){return browser.runtime.sendMessage({command:"GET_PREFERRED_LANGUAGES"})}startDictionarySync(){return browser.runtime.sendMessage({command:"START_DICTIONARY_SYNC"})}updateDictionary(){return browser.runtime.sendMessage({command:"UPDATE_DICTIONARY"})}addWordToDictionary(e){const n={command:"ADD_WORD_TO_DICTIONARY",word:e};return browser.runtime.sendMessage(n)}addWordsToDictionary(e){const n={command:"BATCH_ADD_WORDS_TO_DICTIONARY",words:e};return browser.runtime.sendMessage(n)}removeWordFromDictionary(e){const n={command:"REMOVE_WORD_FROM_DICTIONARY",word:e};return browser.runtime.sendMessage(n)}clearDictionary(){return browser.runtime.sendMessage({command:"CLEAR_DICTIONARY"})}loadSynonyms(e,n,r){const t={command:"LOAD_SYNONYMS",wordContext:e,language:n,motherLanguage:r};return browser.runtime.sendMessage(t)}trackEvent(e,n){const r={command:"TRACK_EVENT",action:e,label:n};return browser.runtime.sendMessage(r)}trackTextLength(e){const n={command:"TRACK_TEXT_LENGTH",textLength:e};return browser.runtime.sendMessage(n)}pageLoaded(e,n,r,t,s){const o={command:"PAGE_LOADED",enabled:e,capitalization:n,supported:r,beta:t,unsupportedMessage:s};return browser.runtime.sendMessage(o)}ltAssistantStatusChanged(e,n){const r="object"==typeof e?e:n,t={command:"LTASSISTANT_STATUS_CHANGED",tabId:"number"==typeof e?e:void 0,enabled:r.enabled,capitalization:r.capitalization};return browser.runtime.sendMessage(t)}check(e,n,r,t,s,o){const a={command:"CHECK_TEXT",text:n,changedParagraphs:r,language:e.language,forceLanguage:e.forceLanguage,hasUserChangedLanguage:o,metaData:t,options:s};return browser.runtime.sendMessage(a)}isOptionsPageSupported(){return!0}openOptionsPage(e,n){const r={command:"OPEN_OPTIONS",target:e,ref:n};return browser.runtime.sendMessage(r)}isFeedbackFormSupported(){return!0}openFeedbackForm(e,n="",r=""){const t={command:"OPEN_FEEDBACK_FORM",url:e,title:n,html:r};return browser.runtime.sendMessage(t)}openPremiumPage(e,n=0,r=0,t=0,s="",o){const a={command:"OPEN_PREMIUM_PAGE",campaign:e,hiddenGrammarMatches:n,hiddenStyleMatches:r,hiddenPunctuationMatches:t,historicMatches:s,textLanguage:o||void 0};return browser.runtime.sendMessage(a)}}
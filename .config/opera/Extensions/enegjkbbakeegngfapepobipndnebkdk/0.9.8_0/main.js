(()=>{"use strict";var e={100:e=>{var t,a="object"==typeof Reflect?Reflect:null,s=a&&"function"==typeof a.apply?a.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};t=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(a,s){function r(a){e.removeListener(t,n),s(a)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",r),a([].slice.call(arguments))}v(e,t,n,{once:!0}),"error"!==t&&function(e,t,a){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var i=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function d(e,t,a,s){var r,n,i,d;if(o(a),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,a.listener?a.listener:a),n=e._events),i=n[t]),void 0===i)i=n[t]=a,++e._eventsCount;else if("function"==typeof i?i=n[t]=s?[a,i]:[i,a]:s?i.unshift(a):i.push(a),(r=c(e))>0&&i.length>r&&!i.warned){i.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=i.length,d=l,console&&console.warn&&console.warn(d)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,a){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},r=l.bind(s);return r.listener=a,s.wrapFn=r,r}function u(e,t,a){var s=e._events;if(void 0===s)return[];var r=s[t];return void 0===r?[]:"function"==typeof r?a?[r.listener||r]:[r]:a?function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}(r):p(r,r.length)}function g(e){var t=this._events;if(void 0!==t){var a=t[e];if("function"==typeof a)return 1;if(void 0!==a)return a.length}return 0}function p(e,t){for(var a=new Array(t),s=0;s<t;++s)a[s]=e[s];return a}function v(e,t,a,s){if("function"==typeof e.on)s.once?e.once(t,a):e.on(t,a);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(n){s.once&&e.removeEventListener(t,r),a(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var d=c.length,l=p(c,d);for(a=0;a<d;++a)s(l[a],this,t)}return!0},n.prototype.addListener=function(e,t){return d(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return d(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},n.prototype.removeListener=function(e,t){var a,s,r,n,i;if(o(t),void 0===(s=this._events))return this;if(void 0===(a=s[e]))return this;if(a===t||a.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!=typeof a){for(r=-1,n=a.length-1;n>=0;n--)if(a[n]===t||a[n].listener===t){i=a[n].listener,r=n;break}if(r<0)return this;0===r?a.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(a,r),1===a.length&&(s[e]=a[0]),void 0!==s.removeListener&&this.emit("removeListener",e,i||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,a,s;if(void 0===(a=this._events))return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var r,n=Object.keys(a);for(s=0;s<n.length;++s)"removeListener"!==(r=n[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=a[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},n.prototype.listeners=function(e){return u(this,e,!0)},n.prototype.rawListeners=function(e){return u(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},n.prototype.listenerCount=g,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},888:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Adblock=void 0;const a="adblocker.enabled";class s{constructor(e){this.variableStore=e,void 0!==chrome.settingsPrivate&&(chrome.settingsPrivate.getPref(a,(e=>{this.variableStore.setInt("adblocker_enabled",e.value?1:0)})),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.forEach((e=>{e.key===a&&this.variableStore.setInt("adblocker_enabled",e.value?1:0)}))})))}static registerVariables(e){e.registerIntVariable("adblocker_enabled",0)}}t.Adblock=s,s.VARIABLES={adblocker_enabled:{default:0,description:"Whether the adblocker is enabled"}}},235:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reloadStartpagesInAllWindowsWhenInBackground=void 0;class a{constructor(e){this.onStartpageInWindowReloaded=e,this.windowsToWaitFor=new Set,this.tabActivatedListener=e=>this.onTabActivated(e),this.tabUpdatedListener=(e,t,a)=>this.onTabUpdated(e,t,a),this.windowRemovedListener=e=>this.onWindowRemoved(e),(async()=>{var e;const t=await new Promise((e=>chrome.windows.getAll((t=>e(t.filter((e=>"normal"===e.type||"popup"===e.type))))))),a=await Promise.all(t.map((e=>new Promise((t=>{chrome.tabs.query({active:!0,windowId:e.id},(a=>t({windowId:e.id,activeTab:a[0]})))})))));for(const t of a)(null===(e=t.activeTab.url)||void 0===e?void 0:e.startsWith("chrome://startpage"))?this.windowsToWaitFor.add(t.windowId):opr.speeddialPrivate.reloadInWindow(t.windowId,(()=>{}));0!==this.windowsToWaitFor.size&&(chrome.tabs.onActivated.addListener(this.tabActivatedListener),chrome.tabs.onUpdated.addListener(this.tabUpdatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener))})()}onTabActivated(e){this.windowsToWaitFor.has(e.windowId)&&chrome.tabs.get(e.tabId,(e=>{this.reloadStartpageIfInBackground(e.windowId,e.url)}))}onTabUpdated(e,t,a){this.windowsToWaitFor.has(a.windowId)&&a.active&&t.url&&this.reloadStartpageIfInBackground(a.windowId,a.url)}onWindowRemoved(e){this.windowsToWaitFor.delete(e),this.onWindowHandled(e)}reloadStartpageIfInBackground(e,t){t.startsWith("chrome://startpage")||(opr.speeddialPrivate.reloadInWindow(e,(()=>{this.onStartpageInWindowReloaded(e)})),this.onWindowHandled(e))}onWindowHandled(e){this.windowsToWaitFor.delete(e),0===this.windowsToWaitFor.size&&(chrome.tabs.onActivated.removeListener(this.tabActivatedListener),chrome.tabs.onUpdated.removeListener(this.tabUpdatedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener))}}t.reloadStartpagesInAllWindowsWhenInBackground=function(e){new a(e)}},932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserLaunchedWithTagAssigned=void 0;class a{constructor(e){this.backend=e}static eventNameForTag(e){return`browser-launched-with-tag-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(){await this.backend.wasRecentlyLaunchedWithTag()&&this.fireEvent()}async deactivate(){}}t.BrowserLaunchedWithTagAssigned=a},793:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CashbackBadgeShownEventSource=void 0,function(e){e[e.INITIALIZING_WINDOW=0]="INITIALIZING_WINDOW",e[e.COMPUTING_IF_COMMIT_CHECK_NEEDED=1]="COMPUTING_IF_COMMIT_CHECK_NEEDED",e[e.WATING_FOR_TAB_COMMIT=2]="WATING_FOR_TAB_COMMIT",e[e.IDLE=3]="IDLE"}(a||(a={}));class s{constructor(e){this.windowCreatedClosures=[],this._state=a.INITIALIZING_WINDOW,this._state=e?a.IDLE:a.INITIALIZING_WINDOW}get hasWindowData(){return this._state!==a.INITIALIZING_WINDOW}get computingIfCommitCheckNeeded(){return this._state===a.COMPUTING_IF_COMMIT_CHECK_NEEDED}get waitingForTabCommit(){return this._state===a.WATING_FOR_TAB_COMMIT}onWindowCreated(){var e;this._state=a.IDLE;for(const t of null!==(e=this.windowCreatedClosures)&&void 0!==e?e:[])t();this.windowCreatedClosures=[]}onComputingIfCommitCheckNeeded(){this._state=a.COMPUTING_IF_COMMIT_CHECK_NEEDED}waitForTabCommit(e){this._state=a.WATING_FOR_TAB_COMMIT;let t=this.stateClosure;this.stateClosure=e,t&&t()}onIdle(){this._state=a.IDLE}commitTab(){this._state=a.IDLE,this.stateClosure&&this.stateClosure(),this.stateClosure=void 0}addWindowReadyClosure(e){this.windowCreatedClosures.push(e)}setStateClosure(e){this.stateClosure=e}}class r{constructor(e){this.variableStore=e,this.cashbackStatesForWindows=new Map,this.cashbackBadgeStateChangedListener=(e,t)=>this.onCashbackStateChanged(e,t),this.windowCreatedListener=e=>this.onWindowCreated(e),this.windowRemovedListener=e=>this.onWindowRemoved(e),this.tabActivatedListener=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.cashbackPrivate}static registerVariables(e){e.registerStringVariable("page_with_cashback",this.VARIABLES.page_with_cashback.default)}getWindowState(e){let t=this.cashbackStatesForWindows.get(e);return t||(t={supported:!1,state:opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new s(!1)},this.cashbackStatesForWindows.set(e,t),t)}getTabInfo(e){return new Promise((t=>{chrome.tabs.query(e,(e=>{t(e[0])}))}))}getCashbackBadgeState(e){return new Promise((t=>opr.cashbackPrivate.getCashbackBadgeState(e,t)))}async onCashbackStateChanged(e,t){const a=this.getWindowState(e);if(!a.stateManager.hasWindowData)return void a.stateManager.addWindowReadyClosure((()=>this.onCashbackStateChanged(e,t)));if(!a.supported)return;a.stateManager.onComputingIfCommitCheckNeeded();const s=await this.getTabInfo({active:!0,windowId:e});let r=()=>a.stateManager.onIdle();try{if(void 0===s)return void a.stateManager.onIdle();if(a.lastKnownActiveTabId!==s.id)return void(r=()=>a.stateManager.waitForTabCommit((()=>this.onCashbackStateChanged(e,t))));a.state===opr.cashbackPrivate.BadgeState.DISABLED&&t!==opr.cashbackPrivate.BadgeState.DISABLED&&await this.fireEvent(s.url),a.state=t}finally{r()}}onWindowCreated(e){const t=this.getWindowState(e.id);t.supported="normal"===e.type&&!e.incognito,t.stateManager.onWindowCreated()}onWindowRemoved(e){this.cashbackStatesForWindows.delete(e)}async onTabActivated(e){const t=this.getWindowState(e.windowId);if(t.stateManager.hasWindowData){if(t.supported)if(t.stateManager.computingIfCommitCheckNeeded)t.stateManager.setStateClosure((()=>this.onTabActivated(e)));else try{if(t.stateManager.waitingForTabCommit)return;const a=await this.getCashbackBadgeState(e.windowId);if(t.state=a,a===opr.cashbackPrivate.BadgeState.DISABLED)return;const s=await new Promise((t=>chrome.tabs.get(e.tabId,t)));await this.fireEvent(s.url)}finally{t.lastKnownActiveTabId=e.tabId,t.stateManager.commitTab()}}else t.stateManager.addWindowReadyClosure((()=>this.onTabActivated(e)))}async fireEvent(e){await this.variableStore.setString("page_with_cashback",e),await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:r.EVENT_SOURCE_NAME},e)))}async activate(){const e=await new Promise((e=>chrome.windows.getAll(e)));chrome.tabs.onActivated.addListener(this.tabActivatedListener),this.cashbackStatesForWindows=new Map(await Promise.all(e.map((e=>new Promise((async t=>{const a="normal"===e.type&&!e.incognito;t([e.id,{supported:a,state:a?await new Promise((t=>{opr.cashbackPrivate.getCashbackBadgeState(e.id,t)})):opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new s(!0)}])})))))),chrome.windows.onCreated.addListener(this.windowCreatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.addListener(this.cashbackBadgeStateChangedListener)}async deactivate(){chrome.tabs.onActivated.removeListener(this.tabActivatedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.removeListener(this.cashbackBadgeStateChangedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener),chrome.windows.onCreated.removeListener(this.windowCreatedListener)}}t.CashbackBadgeShownEventSource=r,r.EVENT_SOURCE_NAME="cashback-badge-shown",r.VARIABLES={page_with_cashback:{default:"none",description:"Page that generated the cashback-badge-shown event"}}},254:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CheckoutPageEventSource=void 0;class a{constructor(e){this.variableStore=e,this.tabsWithForms=new Map,this.autofillFormDetectedCallback=(e,t)=>this.onAutofillFormDetected(e,t),this.tabsUpdatedCallback=(e,t,a)=>this.onTabsUpdated(e,t,a),this.tabsActivatedCallback=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.richHintsAgentPrivate.onAutofillFormDetected}static registerVariables(e){e.registerStringVariable("page_with_checkout_form",this.VARIABLES.page_with_checkout_form.default)}async activate(){opr.richHintsAgentPrivate.onAutofillFormDetected.addListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.addListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.addListener(this.tabsUpdatedCallback)}async deactivate(){opr.richHintsAgentPrivate.onAutofillFormDetected.removeListener(this.autofillFormDetectedCallback),chrome.tabs.onActivated.removeListener(this.tabsActivatedCallback),chrome.tabs.onUpdated.removeListener(this.tabsUpdatedCallback)}async fireEvent(e,t){await this.variableStore.setString("page_with_checkout_form",t),opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e})}onAutofillFormDetected(e,t){this.isCheckoutFormHeuristics(t)&&chrome.tabs.get(e,(t=>{this.tabsWithForms.set(e,t.url),t.active&&this.fireEvent(t.windowId,t.url)}))}onTabsUpdated(e,t,a){t.url&&this.tabsWithForms.delete(e)}onTabActivated(e){const t=this.tabsWithForms.get(e.tabId);t&&this.fireEvent(e.windowId,t)}isCheckoutFormHeuristics(e){return e.fields.find((e=>e.type===opr.richHintsAgentPrivate.AutofillFieldType.CREDIT_CARD_NUMBER))&&e.fields.map((e=>e.group===opr.richHintsAgentPrivate.AutofillFieldGroup.CREDIT_CARD?1:0)).reduce(((e,t)=>e+t))>=2}}t.CheckoutPageEventSource=a,a.EVENT_SOURCE_NAME="checkout-page",a.VARIABLES={page_with_checkout_form:{default:"none",description:"Page that generated the checkout-page event"}}},498:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClockEventSource=t.AgentClock=void 0;const s=a(100);class r{constructor(e){this.variableStore=e,this.sessionStartTime=-1,this.eventEmitter=new s.EventEmitter}static registerVariables(e){e.registerIntVariable("minutes_since_startup",this.VARIABLES.minutes_since_startup.default)}onMinutePassed(e){this.eventEmitter.on("minute-passed",e)}setOnBeforeMinutePassedBarrier(e){this.onBeforeMinutePassedBarrier=e}removeCallback(e){this.eventEmitter.removeListener("minute-passed",e)}async init(e){const t=await new Promise((e=>chrome.storage.local.get("session_data",(t=>{var a;return e(null!==(a=t.session_data)&&void 0!==a?a:{})}))));this.sessionStartTime=await(async()=>("extension_update"===e&&"number"==typeof t.sessionStartTime||(t.sessionStartTime=Date.now(),await new Promise((e=>chrome.storage.local.set({session_data:t},e)))),t.sessionStartTime))(),window.setInterval((()=>this.minutePassedHandler()),6e4),this.minutePassedHandler()}async minutePassedHandler(){const e=Math.round((Date.now()-this.sessionStartTime)/6e4);this.variableStore.setInt("minutes_since_startup",e),this.onBeforeMinutePassedBarrier&&await this.onBeforeMinutePassedBarrier(),this.eventEmitter.emit("minute-passed")}}t.AgentClock=r,r.VARIABLES={minutes_since_startup:{default:0,description:"Time since Opera launched"}};class n{constructor(e){this.clock=e,this.minutePassedCallback=()=>this.onMinutePassed()}async activate(){this.clock.onMinutePassed(this.minutePassedCallback)}async deactivate(){this.clock.removeCallback(this.minutePassedCallback)}onMinutePassed(){opr.richHintsAgentPrivate.fireEvent({eventName:n.EVENT_SOURCE_NAME})}}t.ClockEventSource=n,n.EVENT_SOURCE_NAME="minute-passed"},150:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0,t.Constants=class{constructor(e){this.productType=e}static async getProductType(){if(opr.operaBrowserPrivate)switch(await new Promise((e=>opr.operaBrowserPrivate.getProduct(e)))){case"Opera Crypto":return"crypto";case"Opera GX":return"gx";case"Opera":return"opera";default:return}}}},696:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayTargetedSDSectionFunctionMessage=t.CallTestStartpageFunctionMessage=t.ACS_CallStartpageFunctionMessage=t.ACS_UseApiMessage=t.ContentScriptMessageWithApiType=t.ACS_ErrorMessage=t.CSA_StartpageAPIEventMessage=t.CSA_CallStartpageFunctionResponseMessage=t.ApiToContentScriptMessage=t.ContentScriptToApiMessage=t.ContentScriptConnectionMessage=void 0;class a{constructor(e,t){this.type=e,this.requestId=t,this.id=a.nextId++}}t.ContentScriptConnectionMessage=a,a.nextId=0;class s extends a{}t.ContentScriptToApiMessage=s;class r extends a{}t.ApiToContentScriptMessage=r;class n extends s{constructor(e,t,a){super("CSA_CallStartpageFunctionResponse",t),this.result=e,this.data=a}static fromRawMessage(e){if("CSA_CallStartpageFunctionResponse"!==e.type||"boolean"!=typeof e.result||"number"!=typeof e.requestId||"object"!=typeof e.data)throw new Error("Unparseable message");return new n(e.result,e.requestId,e.data)}}t.CSA_CallStartpageFunctionResponseMessage=n;class i extends s{constructor(e,t,a){super("CSA_StartpageAPIEvent"),this.result=e,this.name=t,this.data=a}static fromRawMessage(e){if("CSA_StartpageAPIEvent"!==e.type||"string"!=typeof e.name||"object"!=typeof e.data)throw new Error("Unparseable message");return new i(e.result,e.name,e.data)}}t.CSA_StartpageAPIEventMessage=i,t.ACS_ErrorMessage=class extends r{constructor(e){super("ACS_Error"),this.message=e}};class o extends r{constructor(e,t,a){super(e,a),this.functionName=t}}t.ContentScriptMessageWithApiType=o;class c extends o{constructor(e,t,a,s){super(e,t,a),this.params=s}}t.ACS_UseApiMessage=c;class d extends c{constructor(e,t,a,s){super(d.MESSAGE_TYPE,e,t,s),this.windowId=a}}t.ACS_CallStartpageFunctionMessage=d,d.MESSAGE_TYPE="ACS_CallStartpageFunction";class l extends d{constructor(e,t,a,s){super("TestStartpageFunction",e,t,{boxColour:a,text:s})}get boxColour(){return this.params.boxColour}get text(){return this.params.text}static fromParams(e,t,a){const s=a.get("colour");if("string"!=typeof s)throw new Error(`Bad colour ${s}`);const r=a.get("text");if("string"!=typeof s)throw new Error(`Bad colour ${s}`);return new l(e,t,s,r)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if("string"!=typeof e.params.boxColour)throw new Error("boxColour not a string");if("string"!=typeof e.params.text)throw new Error("text not a string");return new l(e.requestId,e.windowId,e.params.boxColour,e.params.text)}}t.CallTestStartpageFunctionMessage=l;class h extends d{constructor(e,t,a,s,r,n,i,o,c,d,l){super("DisplayTargetedSDSection",e,t,{tiles:a,sectionTitle:s,folded:r,doubleWidthTiles:n,noWrap:i,tileHeight:o,closeMenuOptionNames:c,feedbackEnabled:d,campaignId:l}),this.tiles=a,this.sectionTitle=s,this.folded=r,this.doubleWidthTiles=n,this.noWrap=i,this.tileHeight=o,this.closeMenuOptionNames=c,this.feedbackEnabled=d,this.campaignId=l}static createTilesFromArray(e){let t=[];for(let a of e){if("string"!=typeof a.clickUrl)throw new Error("tiles[i].clickUrl must be a string");if("string"!=typeof a.imageUrl)throw new Error("tiles[i].imageUrl must be a string");if("string"!=typeof a.title)throw new Error("tiles[i].title must be a string");t.push({clickUrl:a.clickUrl,imageUrl:a.imageUrl,title:a.title})}return t}static fromParams(e,t,a){const s=a.get("tiles");if(!(s instanceof Array))throw new Error("tiles should be an array");const r=a.get("sectionTitle");if("string"!=typeof r)throw new Error("sectionTitle should be a string");const n=a.get("folded");if("boolean"!=typeof n)throw new Error("folded should be a boolean");const i=a.get("doubleWidthTiles");if("boolean"!=typeof i)throw new Error("doubleWidthTiles should be a boolean");const o=a.get("noWrap");if("boolean"!=typeof o)throw new Error("noWrap should be a boolean");const c=a.get("tileHeight");if("number"!=typeof c)throw new Error("tileHeight should be a number");const d=a.get("closeMenuOptionNames");if(d instanceof Array&&d.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");const l=a.get("feedbackEnabled");if("boolean"!=typeof l)throw new Error("feedbackEnabled should be a boolean");const u=a.get("campaignId");if("string"!=typeof u)throw new Error("campaignId should be a string");return new h(e,t,h.createTilesFromArray(s),r,n,i,o,c,d,l,u)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if(!(e.params.tiles instanceof Array))throw new Error("params.tiles not an array");if("string"!=typeof e.params.sectionTitle)throw new Error("sectionTitle should be a string");if("boolean"!=typeof e.params.folded)throw new Error("folded should be a boolean");if("boolean"!=typeof e.params.doubleWidthTiles)throw new Error("doubleWidthTiles should be a boolean");if("boolean"!=typeof e.params.noWrap)throw new Error("noWrap should be a boolean");if("number"!=typeof e.params.tileHeight)throw new Error("tileHeight should be a number");if(e.params.closeMenuOptionNames instanceof Array&&e.params.closeMenuOptionNames.some((e=>"string"!=typeof e)))throw new Error("closeMenuOptionNames should be a string array");if("boolean"!=typeof e.params.feedbackEnabled)throw new Error("feedbackEnabled should be a boolean");if("string"!=typeof e.params.campaignId)throw new Error("campaignId should be a string");return new h(e.requestId,e.windowId,h.createTilesFromArray(e.tiles),e.params.sectionTitle,e.params.folded,e.params.doubleWidthTiles,e.params.noWrap,e.params.tileHeight,e.params.closeMenuOptionNames,e.params.feedbackEnabled,e.params.campaignId)}}t.DisplayTargetedSDSectionFunctionMessage=h},71:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorReporter=void 0,t.ErrorReporter=class{constructor(){opr.richHintsAgentPrivate.reportFeedback&&(window.addEventListener("error",(e=>this.onUncaughtError(e.error))),window.addEventListener("unhandledrejection",(e=>this.onUnhandledRejection(e.reason))))}onUncaughtError(e){this.reportError("string"==typeof e?e:e.message)}onUnhandledRejection(e){this.reportError("string"==typeof e?e:e.message)}reportError(e){e&&opr.richHintsAgentPrivate.reportFeedback(opr.richHintsAgentPrivate.FeedbackType.ERROR,""+e)}}},778:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventRegistry=void 0;const s=a(100);t.EventRegistry=class{constructor(e,t,a){this.onSpecificationUpdated=e,this.provideEvents=t,this.eventSourceFactory=a,this.eventsSources=new Map,this.eventEmitter=new s.EventEmitter,this.onSpecificationUpdated.addListener((()=>{this.registerEvents()}))}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}registerEvents(){this.eventEmitter.emit("start-providing-events"),this.provideEvents(this.eventSourceFactory.getSupportedEvents(),(e=>{let t=Array.from(this.eventsSources.keys()),a=e.filter((e=>-1===t.indexOf(e))),s=t.filter((t=>-1===e.indexOf(t)));a.forEach((e=>{let t=this.eventSourceFactory.createEventSource(e);t?(this.eventsSources.set(e,t),t.activate(this)):console.warn("The event "+t+" is unknown and cannot be handled")})),s.forEach((e=>{this.eventsSources.get(e).deactivate(this),this.eventsSources.delete(e)}))}))}}},175:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceFactoryImpl=void 0,t.EventSourceFactoryImpl=class{constructor(e){this.eventFactories=e}createEventSource(e){let t=this.eventFactories.get(e);return t?t():null}getSupportedEvents(){return Array.from(this.eventFactories.keys())}}},977:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkExtensionLaunchType=void 0,t.checkExtensionLaunchType=async function(){const e=await new Promise((e=>chrome.storage.local.get("launch_type_check",(t=>{var a;return e(null!==(a=t.launch_type_check)&&void 0!==a?a:{})})))),t=chrome.runtime.getManifest().version,a=void 0===e.last_recorded_version?"first_install":e.last_recorded_version===t?"browser_launch":"extension_update";return e.last_recorded_version=t,await new Promise((t=>chrome.storage.local.set({launch_type_check:e},t))),a}},919:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionPromotions=void 0;class a{constructor(e){[{id:a.ALITOOLS_EXTENSION_ID,variableNames:{has:a.HAS_ALITOOLS_VARIABLE_NAME,uninstalled:a.UNINSTALLED_ALITOOLS_VARIABLE_NAME}},{id:a.AMAZON_EXTENSION_ID,variableNames:{has:a.HAS_AMAZON_VARIABLE_NAME,uninstalled:a.UNINSTALLED_AMAZON_VARIABLE_NAME}}].forEach((t=>{chrome.management.get(t.id,(()=>{e.setInt(t.variableNames.has,void 0===chrome.runtime.lastError?1:0)})),chrome.management.onInstalled.addListener((a=>{t.id===a.id&&e.setInt(t.variableNames.has,1)})),chrome.management.onUninstalled.addListener((a=>{t.id===a&&(e.setInt(t.variableNames.has,0),e.setInt(t.variableNames.uninstalled,1))}))}))}static registerVariables(e){e.registerIntVariable(a.UNINSTALLED_ALITOOLS_VARIABLE_NAME,a.VARIABLES.uninstalled_alitools.default),e.registerIntVariable(a.UNINSTALLED_AMAZON_VARIABLE_NAME,a.VARIABLES.uninstalled_amazon.default),e.registerIntVariable(a.HAS_ALITOOLS_VARIABLE_NAME,a.VARIABLES.has_alitools.default),e.registerIntVariable(a.HAS_AMAZON_VARIABLE_NAME,a.VARIABLES.has_amazon.default)}}t.ExtensionPromotions=a,a.VARIABLES={has_alitools:{default:0,description:"Whether Alitools is currently installed"},has_amazon:{default:0,description:"Whether the Amazon assistant is currently installed"},uninstalled_alitools:{default:0,description:"Whether Alitools has ever been uninstalled"},uninstalled_amazon:{default:0,description:"Whether the Amazon assistant has ever been uninstalled"}},a.ALITOOLS_EXTENSION_ID="nkekkheibgkgeepapinkalkongndfajn",a.AMAZON_EXTENSION_ID="mmmbddcnnndpbdflpccgcknaaabgldak",a.HAS_ALITOOLS_VARIABLE_NAME="has_alitools",a.HAS_AMAZON_VARIABLE_NAME="has_amazon",a.UNINSTALLED_ALITOOLS_VARIABLE_NAME="uninstalled_alitools",a.UNINSTALLED_AMAZON_VARIABLE_NAME="uninstalled_amazon"},727:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionBroker=t.defaultExternalConnectionPortFactory=t.ExternalConnectionPort=void 0;const s=a(100),r=a(278);class n{constructor(e,t,a){this.rawPort=t,this.portId=a,this.eventEmitter=new s.EventEmitter,t.onMessage.addListener((t=>{try{const a=e.parse(t);a.port=this,this.eventEmitter.emit("message",a)}catch(e){this.postMessage(new r.AC_ErrorMessage(e.message))}})),t.onDisconnect.addListener((e=>{this.eventEmitter.emit("disconnect",this)}))}onMessage(e){this.eventEmitter.on("message",e)}onDisconnect(e){this.eventEmitter.on("disconnect",e)}removeMessageListener(e){this.eventEmitter.removeListener("message",e)}removeDisconnectListener(e){this.eventEmitter.removeListener("disconnect",e)}postMessage(e){this.rawPort.postMessage(e)}}t.ExternalConnectionPort=n,t.defaultExternalConnectionPortFactory=function(e,t,a){return new n(e,t,a)},t.ExternalConnectionBroker=class{constructor(e,t){this.listenersForAPIs=new Map,this.nextPortId=0,chrome.runtime.onConnectExternal.addListener((a=>{const s=this.listenersForAPIs.get(a.name);if(!s)return a.postMessage(new r.AC_ErrorMessage(`No known API for ${a.name}`)),void a.disconnect();s(t(e,a,this.nextPortId++))}))}registerConnectionListener(e,t){if(this.listenersForAPIs.has(e))throw new Error("Listener already registered");this.listenersForAPIs.set(e,t)}}},278:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionMessageParser=t.AC_ErrorMessage=t.ExternalConnectionClientToApiMessage=t.ExternalConnectionApiToClientMessage=t.ExternalConnectionMessage=void 0;class a{constructor(e){this.type=e,this.id=a.nextId++}}t.ExternalConnectionMessage=a,a.nextId=0;class s extends a{}t.ExternalConnectionApiToClientMessage=s,t.ExternalConnectionClientToApiMessage=class extends a{get port(){return this._port}set port(e){this._port=e}},t.AC_ErrorMessage=class extends s{constructor(e){super("AC_Error"),this.message=e}},t.ExternalConnectionMessageParser=class{constructor(){this.parsers=new Map}registerMessageParser(e,t){this.parsers.set(e,t)}parse(e){const t=e.type;if("string"!=typeof t)throw new Error("Unreadable message type");const a=this.parsers.get(t);if(!a)throw new Error(`Unknown message type ${t}`);return a(e)}}},259:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTag=t.MatcherRegex=void 0;class a{constructor(e){this.regex=new RegExp(e)}isMatch(e){return this.regex.test(e)}}t.MatcherRegex=a;class s{constructor(e,t,a,s,r,n){this.matchers=e,this.negative_matchers=t,this.tag=a,this.search_limit_days=s,this.min_matchers_to_qualify=r,this.active=n}static createFromJson(e){return e.map((e=>new s(e.matchers.map((e=>new a(e))),e.negative_matchers.map((e=>new a(e))),e.tag,e.search_limit_days,e.min_matchers_to_qualify,e.active)))}}t.HistoryTag=s},839:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagAssignedEventSource=void 0;class a{constructor(e){this.backend=e,this.tagAssignedCallback=()=>{this.fireEvent()}}static eventNameForTag(e){return`history-tag-assigned-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:a.eventNameForTag(this.backend.tagName)})}async activate(e){this.backend.watchForTagAssignment(e)&&this.backend.on("tag-assigned-at-random-time",this.tagAssignedCallback)}async deactivate(e){this.backend.stopWatching(e),this.backend.removeListener("tag-assigned-at-random-time",this.tagAssignedCallback)}}t.HistoryTagAssignedEventSource=a},987:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagEventsBackend=void 0;const s=a(100);class r{}class n{constructor(e,t,a,r,n,i,o){this.tagName=e,this.storageKey=t,this.extensionLaunchType=a,this.extensionLaunchTime=r,this.historyTagUpdater=n,this.historyTagStorage=i,this.state=o,this.eventEmitter=new s.EventEmitter,this.tagsChangedEventListener=()=>{this.reportTagAssigned()},this.watching=!1}static async make(e,t,a,s,i,o){const c=await new Promise((t=>chrome.storage.local.get(e,(a=>{var s;return t(null!==(s=a[e])&&void 0!==s?s:new r)}))));return c.tag_assigned_event_reported=!0===c.tag_assigned_event_reported,new n(s,e,a,t,i,o,c)}static getDefaultStorageKey(e){return`history_tag_assigned_event_source_${e}`}async wasRecentlyLaunchedWithTag(){const e=Date.now();return!("browser_launch"!==this.extensionLaunchType||e-this.extensionLaunchTime>n.LAUNCH_DELAY)&&(await this.historyTagUpdater.waitForPendingUpdate(),this.historyTagStorage.hasTag(this.tagName))}watchForTagAssignment(e){return!this.state.tag_assigned_event_reported&&(this.historyTagStorage.on("tags-changed",this.tagsChangedEventListener),this.watching=!0,!0)}stopWatching(e){this.watching&&(this.historyTagStorage.removeListener("tags-changed",this.tagsChangedEventListener),this.watching=!1)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async saveState(){chrome.storage.local.set({[this.storageKey]:this.state})}async setAlreadyReported(){this.state.tag_assigned_event_reported=!0,await this.saveState()}async reportTagAssigned(){!this.state.tag_assigned_event_reported&&this.historyTagStorage.hasTag(this.tagName)&&(await this.setAlreadyReported(),this.eventEmitter.emit("tag-assigned-at-random-time"))}}t.HistoryTagEventsBackend=n,n.LAUNCH_DELAY=2e4},603:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagStorage=void 0;const s=a(100),r=a(259);class n{constructor(e,t){this.tagState=e,this.variableStore=t,this.eventEmitter=new s.EventEmitter}hasTag(e){return!0===this.tagState.get(e)}static tagNameToStorageName(e){return`history_tag_${e}`}stateToStorage(){const e={history_tags:{}};return this.tagState.forEach(((t,a)=>e.history_tags[a]=t)),e}static async readHistoryTagsFromJson(e){const t=await fetch(chrome.runtime.getURL(e)),a=await t.json();return r.HistoryTag.createFromJson(a).filter((e=>e.active))}static registerVariables(e,t){t.forEach((t=>e.registerIntVariable(n.tagNameToStorageName(t.tag),0)))}static async load(e,t){const a=await new Promise((t=>chrome.storage.local.get(e,t))),s=new Map(Object.keys(a).map((e=>[e,!0===a[e]])));return new n(s,t)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async save(e){const t=Array.from(e.keys()).some((t=>this.tagState.get(t)!==e.get(t)))||Array.from(this.tagState.keys()).some((t=>this.tagState.get(t)!==e.get(t)));this.tagState=e;const a=this.stateToStorage();await new Promise((e=>chrome.storage.local.set(a,e)));for(const e of Array.from(this.tagState.entries()))await this.variableStore.setInt(n.tagNameToStorageName(e[0]),e[1]?1:0,"dont_flush");await this.variableStore.save(),t&&this.eventEmitter.emit("tags-changed")}}t.HistoryTagStorage=n},854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagUpdater=void 0;class a{constructor(e,t,a){this.storage=e,this.tags=t,setInterval((()=>this.updateTags()),a)}init(e){e.on("start-providing-events",(()=>{this.updateTags()}))}async updateTags(){this.updatingAfterSpecChangePromise||(this.updatingAfterSpecChangePromise=(async()=>{await this.storage.save(await this.calculateTagsFromHistory())})(),await this.updatingAfterSpecChangePromise,this.updatingAfterSpecChangePromise=void 0)}async waitForPendingUpdate(){return this.updatingAfterSpecChangePromise?this.updatingAfterSpecChangePromise:Promise.resolve()}async searchHistory(e){return new Promise((t=>chrome.history.search({text:"",startTime:e,maxResults:1e5},t)))}anyResultMatches(e,t,a){return e.some((e=>!(!e.lastVisitTime||e.lastVisitTime<a)&&void 0!==t.find((t=>t.isMatch(e.url)))))}nResultsMatch(e,t,a,s){let r=Array.from(new Set(e.flat().map((e=>{if(e.lastVisitTime&&!(e.lastVisitTime<s))return void 0!==t.find((t=>t.isMatch(e.url)))?e.url:void 0})).filter((e=>e)).map((e=>e))));return t.filter((e=>r.some((t=>e.isMatch(t))))).length>=a}async calculateTagsFromHistory(){const e=Math.max(...this.tags.map((e=>e.search_limit_days))),t=await this.searchHistory(e);return new Map(await Promise.all(this.tags.map((async e=>{const s=Date.now()-e.search_limit_days*a.DAYS_TO_MS;return this.anyResultMatches(t,e.negative_matchers,s)?[e.tag,!1]:[e.tag,this.nResultsMatch(t,e.matchers,e.min_matchers_to_qualify,s)]}))))}}t.HistoryTagUpdater=a,a.DAYS_TO_MS=864e5},220:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InjectionBasedPageApiManager=t.InjectionBasedStartpageApi=t.InjectionBasedPageApi=t.StartpageContentScriptMessageRelay=void 0;const s=a(235),r=a(100),n=a(278),i=a(696),o=a(605);class c extends class{constructor(e){this.messageConverter=e,this.awaitingResponse=new Map}acceptContentScriptConnection(e){e.onMessage.addListener((t=>{this.onMessageFromContentScript(e,t)}))}async relayMessageFromApiClient(e,t){await this.postMessageToContentScript(this.messageConverter.convertCAToACS(e)),this.awaitingResponse.set(e.id,t)}handleEventMessage(e,t){return!1}onMessageFromContentScript(e,t){try{const a=this.messageConverter.covertRawCSAToCSA(t);if(this.handleEventMessage(e,a))return;const s=this.awaitingResponse.get(a.requestId);s&&(s.postMessage(this.messageConverter.convertCSAToAC(a)),this.awaitingResponse.delete(a.requestId))}catch(e){return}}}{constructor(e){super(e),this.contentScriptPortsForWindows=new Map,this.eventEmitter=new r.EventEmitter}hasContentScriptConnectionForWindow(e){return!!this.contentScriptPortsForWindows.get(e)}static defaultMessageConverter(){return{convertCAToACS:e=>{if("CA_CallStartpageFunction"===e.type){const t=e;switch(t.functionName){case"TestStartpageFunction":return i.CallTestStartpageFunctionMessage.fromParams(t.id,t.windowId,t.params);case"DisplayTargetedSDSection":return i.DisplayTargetedSDSectionFunctionMessage.fromParams(t.id,t.windowId,t.params);default:throw new Error(`Unrecognized function: ${t.functionName}`)}}throw new Error(`Message type ${e.type} does not map to a content script message`)},covertRawCSAToCSA:e=>{if("CSA_CallStartpageFunctionResponse"===e.type)return i.CSA_CallStartpageFunctionResponseMessage.fromRawMessage(e);if("CSA_StartpageAPIEvent"===e.type)return i.CSA_StartpageAPIEventMessage.fromRawMessage(e);throw new Error("Unknown message received")},convertCSAToAC:e=>{if("CSA_CallStartpageFunctionResponse"!==e.type)throw new Error(`Unsupported message type ${e.type}`);const t=e;return new o.AC_CallStartpageFunctionResponseMessage({result:t.result,data:t.data})}}}on(e,t){this.eventEmitter.on(e,t)}onStartpageEvent(e){this.eventEmitter.on("startpage-script-event",e)}acceptContentScriptConnection(e){const t=e.sender.tab.windowId;if(this.contentScriptPortsForWindows.has(t))return e.postMessage(new i.ACS_ErrorMessage("This window already has an active startpage content script connection")),void e.disconnect();this.contentScriptPortsForWindows.set(t,e),this.eventEmitter.emit("startpage-script-ready",t),e.onDisconnect.addListener((()=>{this.contentScriptPortsForWindows.delete(t)})),super.acceptContentScriptConnection(e)}async postMessageToContentScript(e){const t=e,a=this.contentScriptPortsForWindows.get(t.windowId);a?a.postMessage(t):await new Promise(((e,a)=>{chrome.windows.get(t.windowId,(e=>{e||a(new Error(`No window of id ${t.windowId}`)),a(new Error(`SD content script not ready in window id ${t.windowId}`))}))}))}handleEventMessage(e,t){if("CSA_StartpageAPIEvent"===t.type){const a=t;return this.eventEmitter.emit("startpage-script-event",e.sender.tab.windowId,a.name,a.data),!0}return!1}}t.StartpageContentScriptMessageRelay=c;class d{constructor(e,t,a){this.messageRelay=e,this.apiLevel=t,this.apiName=a,this.activeClients=[]}get apiLevelVariableName(){return`${this.apiName}_api_level`}registerVariables(e,t){e.registerIntVariable(this.apiLevelVariableName,this.apiLevel)}publishApiLevel(e){e.setInt(this.apiLevelVariableName,this.apiLevel)}onClientConnected(e){this.activeClients.push(e)}onClientDisconnected(e){this.activeClients.splice(this.activeClients.indexOf(e),1)}onMessageFromApiClient(e,t){"CA_GetApiLevel"!==t.type?this.messageRelay.relayMessageFromApiClient(t,e).then().catch((t=>{e.postMessage(new n.AC_ErrorMessage(t.message))})):e.postMessage(new o.AC_GetApiLevelResponseMessage(this.apiLevel))}acceptContentScriptConnection(e){this.messageRelay.acceptContentScriptConnection(e)}}t.InjectionBasedPageApi=d;class l extends d{constructor(e,t){super(t,l.API_LEVEL,l.API_PORT_NAME),this.externalConnectionMessageParser=e,this.startpageMessageRelay=t,this.externalConnectionMessageParser.registerMessageParser(o.CA_CallStartpageFunctionMessage.MESSAGE_TYPE,o.CA_CallStartpageFunctionMessage.fromRawMessage),this.externalConnectionMessageParser.registerMessageParser(o.CA_GetInjectedScriptStatusMessage.MESSAGE_TYPE,o.CA_GetInjectedScriptStatusMessage.fromRawMessage),(0,s.reloadStartpagesInAllWindowsWhenInBackground)((()=>{})),t.on("startpage-script-ready",(e=>this.onStartpageMessageSinkReady(e))),t.onStartpageEvent(((e,t,a)=>this.onStartpageEvent(e,t,a)))}onMessageFromApiClient(e,t){"CA_GetInjectedScriptStatus"!==t.type?super.onMessageFromApiClient(e,t):e.postMessage(new o.AC_GetInjectedScriptStatusResponseMessage(this.startpageMessageRelay.hasContentScriptConnectionForWindow(t.windowId)))}onStartpageMessageSinkReady(e){this.activeClients.forEach((t=>{t.postMessage(new o.AC_WindowScriptsReadyMessage(e))}))}onStartpageEvent(e,t,a){this.activeClients.forEach((s=>{s.postMessage(new o.AC_StartpageAPIEvent(e,t,a))}))}}t.InjectionBasedStartpageApi=l,l.API_PORT_NAME="sd_cs",l.API_LEVEL=3,t.InjectionBasedPageApiManager=class{constructor(e,t,a){this.pageApis=a,t.registerMessageParser(o.CA_GetApiLevelMessage.MESSAGE_TYPE,(()=>new o.CA_GetApiLevelMessage)),this.registerApisWithBroker(e),chrome.runtime.onConnect.addListener((e=>{const t=this.pageApis.get(e.name);if(!t)return e.postMessage(new i.ACS_ErrorMessage(`Content script claims to serve an API '${e.name}' that does not exist`)),void e.disconnect();t.acceptContentScriptConnection(e)}))}registerApisWithBroker(e){this.pageApis.forEach(((t,a)=>{e.registerConnectionListener(a,(e=>{t.onClientConnected(e),e.onMessage((a=>{t.onMessageFromApiClient(e,a)})),e.onDisconnect((()=>{t.onClientDisconnected(e)}))}))}))}static defaultServicedApiMap(e){const t=new Map;return t.set(l.API_PORT_NAME,new l(e,new c(c.defaultMessageConverter()))),t}static registerVariables(e,t){t.forEach(((t,a)=>{t.registerVariables(e,a)}))}}},605:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AC_GetInjectedScriptStatusResponseMessage=t.AC_GetApiLevelResponseMessage=t.AC_StartpageAPIEvent=t.AC_CallStartpageFunctionResponseMessage=t.AC_WindowScriptsReadyMessage=t.CA_CallStartpageFunctionMessage=t.UseInjectionBasedApiMessage=t.CA_GetInjectedScriptStatusMessage=t.CA_GetApiLevelMessage=t.ClientToApiInjectionBasedApiMessage=void 0;const s=a(541),r=a(278),n=a(278);class i extends r.ExternalConnectionClientToApiMessage{}t.ClientToApiInjectionBasedApiMessage=i;class o extends i{constructor(){super(o.MESSAGE_TYPE)}}t.CA_GetApiLevelMessage=o,o.MESSAGE_TYPE="CA_GetApiLevel";class c extends i{constructor(e){super(c.MESSAGE_TYPE),this.windowId=e}static fromRawMessage(e){const t=e.windowId;if("number"!=typeof t)throw new Error("windowId invalid");return new c(t)}}t.CA_GetInjectedScriptStatusMessage=c,c.MESSAGE_TYPE="CA_GetInjectedScriptStatus";class d extends i{constructor(e,t){super(e),this.functionName=t}}t.UseInjectionBasedApiMessage=d;class l extends d{constructor(e,t,a){super(l.MESSAGE_TYPE,e),this.windowId=t,this.params=a}static fromRawMessage(e){const t=e.functionName;if(t!==s.TEST_STARTPAGE_FUNCTION&&t!==s.DISPLAY_TARGETED_SD_SECTION_FUNCTION)throw new Error(`functionName invalid: ${t}`);const a=e.windowId;if("number"!=typeof a)throw new Error("windowId invalid");const r=e.params;if("object"!=typeof r)throw new Error("params should be an object");const n=new Map;for(const e in r)n.set(e,r[e]);return new l(t,a,n)}}t.CA_CallStartpageFunctionMessage=l,l.MESSAGE_TYPE="CA_CallStartpageFunction";class h extends n.ExternalConnectionApiToClientMessage{constructor(e){super(h.MESSAGE_TYPE),this.windowId=e}}t.AC_WindowScriptsReadyMessage=h,h.MESSAGE_TYPE="AC_WindowScriptsReady";class u extends n.ExternalConnectionApiToClientMessage{constructor(e){super(u.MESSAGE_TYPE),this.data=e}}t.AC_CallStartpageFunctionResponseMessage=u,u.MESSAGE_TYPE="AC_CallStartpageFunctionResponse";class g extends n.ExternalConnectionApiToClientMessage{constructor(e,t,a){super(g.MESSAGE_TYPE),this.windowId=e,this.name=t,this.data=a}}t.AC_StartpageAPIEvent=g,g.MESSAGE_TYPE="AC_StartpageAPIEvent";class p extends n.ExternalConnectionApiToClientMessage{constructor(e){super(p.MESSAGE_TYPE),this.apiLevel=e}}t.AC_GetApiLevelResponseMessage=p,p.MESSAGE_TYPE="AC_GetApiLevelResponse";class v extends n.ExternalConnectionApiToClientMessage{constructor(e){super(v.MESSAGE_TYPE),this.scriptsReady=e}}t.AC_GetInjectedScriptStatusResponseMessage=v,v.MESSAGE_TYPE="AC_GetInjectedScriptStatusResponse"},541:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TARGETED_SD_SECTION_FUNCTION=t.TEST_STARTPAGE_FUNCTION=void 0,t.TEST_STARTPAGE_FUNCTION="TestStartpageFunction",t.DISPLAY_TARGETED_SD_SECTION_FUNCTION="DisplayTargetedSDSection"},952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,s=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=s}areManyTabsOpen(){return this.performanceVariableCollector.totalTabNumber>=this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onTotalTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout(this.fireEventCallback.bind(this),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onTotalTabNumberChangedListener(),this.performanceVariableCollector.addTotalTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeTotalTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-grow-2382",a.DEFAULT_MIN_NUMBER_OF_TABS=25,a.DEFAULT_EVENT_FIRE_DELAY=6e5},130:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ManyTabsFlowEventSource=void 0;class a{constructor(e,t=a.DEFAULT_MIN_NUMBER_OF_TABS,s=a.DEFAULT_EVENT_FIRE_DELAY){this.performanceVariableCollector=e,this.minNumberOfTabs=t,this.timeToFireEvent=s,chrome.tabs.onActivated.addListener((()=>{void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent))}))}areManyTabsOpen(){return this.performanceVariableCollector.currentWindowTabNumber>this.minNumberOfTabs}async fireEventCallback(){this.areManyTabsOpen()&&opr.richHintsAgentPrivate.fireEvent({eventName:a.EVENT_SOURCE_NAME}),delete this.timeoutId}async onCurrentWindowTabNumberChangedListener(){this.areManyTabsOpen()?void 0===this.timeoutId&&(this.timeoutId=setTimeout((()=>{this.fireEventCallback()}),this.timeToFireEvent)):void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),delete this.timeoutId)}async activate(){this.listenerObject=()=>this.onCurrentWindowTabNumberChangedListener(),this.performanceVariableCollector.addCurrentWindowTabNumberChangedListener(this.listenerObject)}async deactivate(){this.performanceVariableCollector.removeCurrentWindowTabNumberChangedListener(this.listenerObject),delete this.listenerObject,clearTimeout(this.timeoutId),delete this.timeoutId}}t.ManyTabsFlowEventSource=a,a.EVENT_SOURCE_NAME="many-tabs-flow-grow-2432",a.DEFAULT_MIN_NUMBER_OF_TABS=15,a.DEFAULT_EVENT_FIRE_DELAY=6e5},365:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceVariableCollector=void 0;const s=a(100);class r{constructor(e,t,a){this.constants=e,this.variableStore=t,this.clock=a,this.eventEmitter=new s.EventEmitter}static isBoosterApiAvailable(e){return"gx"===e.productType}static isLimitersApiAvailable(e){return"gx"===e.productType}static isPowerSaverApiAvailable(){return void 0!==opr.powerSavePrivate&&void 0!==opr.powerSavePrivate.onBatteryStatusChanged&&void 0!==opr.powerSavePrivate.onStatusChanged}static registerVariables(e,t){t.registerIntVariable("downloads_size",this.VARIABLES.downloads_size.default),t.registerIntVariable("total_tab_count",this.VARIABLES.total_tab_count.default),t.registerIntVariable("current_window_tab_count",this.VARIABLES.current_window_tab_count.default),r.isBoosterApiAvailable(e)&&t.registerIntVariable("browser_files_size",this.VARIABLES.browser_files_size.default),r.isLimitersApiAvailable(e)&&t.registerIntVariable("ram_usage",this.VARIABLES.ram_usage.default),r.isPowerSaverApiAvailable()&&(t.registerStringVariable("battery_status",this.VARIABLES.battery_status.default),t.registerIntVariable("battery_level_percent",this.VARIABLES.battery_level_percent.default),t.registerIntVariable("battery_saver_enabled",this.VARIABLES.battery_saver_enabled.default),t.registerIntVariable("battery_saver_is_saving_now",this.VARIABLES.battery_saver_is_saving_now.default),t.registerIntVariable("battery_saver_auto_on_enabled",this.VARIABLES.battery_saver_auto_on_enabled.default))}async init(){chrome.tabs.onCreated.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats()})),chrome.tabs.onRemoved.addListener((()=>{this.collectTabStats(),this.collectCurrentWindowTabStats()})),chrome.windows.onFocusChanged.addListener((()=>this.collectCurrentWindowTabStats())),chrome.downloads.onChanged.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onErased.addListener((()=>this.collectDownloadsStats())),chrome.downloads.onCreated.addListener((()=>this.collectDownloadsStats())),this.clock.setOnBeforeMinutePassedBarrier((()=>this.collectPerformanceStats())),chrome.settingsPrivate.onPrefsChanged.addListener((e=>{e.find((e=>"power_save_mode.feature_enabled"===e.key||"power_save_mode.automatic_enabled"===e.key))&&this.collectPrefs()})),r.isPowerSaverApiAvailable()&&(opr.powerSavePrivate.onStatusChanged.addListener((e=>this.setBatterySaverIsSavingVariable(e.isEnabled))),opr.powerSavePrivate.onBatteryStatusChanged.addListener((e=>this.setBatteryStatusVariables(e)))),await this.collectTabStats(),await this.collectCurrentWindowTabStats(),await this.collectDownloadsStats(),await this.collectPerformanceStats(),await this.collectBatteryStats()}get totalTabNumber(){return this.totalTabNumber_}get currentWindowTabNumber(){return this.currentWindowTabNumber_}addTotalTabNumberChangedListener(e){this.eventEmitter.on("total-tab-number-changed",e)}removeTotalTabNumberChangedListener(e){this.eventEmitter.removeListener("total-tab-number-changed",e)}addCurrentWindowTabNumberChangedListener(e){this.eventEmitter.on("current-window-tab-number-changed",e)}removeCurrentWindowTabNumberChangedListener(e){this.eventEmitter.removeListener("current-window-tab-number-changed",e)}async collectTabStats(){const e=await new Promise((e=>chrome.windows.getAll({populate:!0},e)));this.totalTabNumber_=e.filter((e=>"normal"===e.type)).map((e=>e.tabs.length)).reduce(((e,t)=>t+e),0),this.variableStore.setInt("total_tab_count",this.totalTabNumber_),this.eventEmitter.emit("total-tab-number-changed",this.totalTabNumber_)}async collectCurrentWindowTabStats(){this.currentWindowTabNumber_=(await new Promise((e=>chrome.tabs.query({currentWindow:!0,pinned:!1},e)))).length,this.variableStore.setInt("current_window_tab_count",this.currentWindowTabNumber_),this.eventEmitter.emit("current-window-tab-number-changed",this.currentWindowTabNumber_)}async getDownloadsDiskSpace(){return new Promise((e=>{chrome.downloads.search({exists:!0},(t=>{e(t.reduce(((e,t)=>e+(t.exists?t.bytesReceived:0)),0))}))}))}async collectDownloadsStats(){var e;this.variableStore.setInt("downloads_size",(e=await this.getDownloadsDiskSpace(),Math.floor(e/1048576)))}async collectPerformanceStats(){if(r.isBoosterApiAvailable(this.constants)){const e=await new Promise((e=>chrome.boosterPrivate.getTotalUsedDiskSpace(e)));this.variableStore.setInt("browser_files_size",e)}if(r.isLimitersApiAvailable(this.constants)){const e=await new Promise((e=>opr.limitersPrivate.getCurrentMemoryUsage(e)));this.variableStore.setInt("ram_usage",e.memoryUsed)}}async collectPrefs(){const e=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.automatic_enabled",e)));this.variableStore.setInt("battery_saver_auto_on_enabled",e.value?1:0);const t=await new Promise((e=>chrome.settingsPrivate.getPref("power_save_mode.feature_enabled",e)));this.variableStore.setInt("battery_saver_enabled",t.value?1:0)}async setBatteryStatusVariables(e){this.variableStore.setString("battery_status",e.dischargingState),this.variableStore.setInt("battery_level_percent",Math.round(100*e.level))}async setBatterySaverIsSavingVariable(e){this.variableStore.setInt("battery_saver_is_saving_now",e?1:0)}async collectBatteryStats(){if(!r.isPowerSaverApiAvailable())return;const e=await new Promise((e=>opr.powerSavePrivate.getStatus(e)));await this.setBatterySaverIsSavingVariable(e.isEnabled);const t=await new Promise((e=>opr.powerSavePrivate.getBatteryStatus(e)));await this.setBatteryStatusVariables(t),await this.collectPrefs()}}t.PerformanceVariableCollector=r,r.VARIABLES={total_tab_count:{default:0,description:"Total tabs in all windows"},current_window_tab_count:{default:0,description:"Number of tabs in current window"},ram_usage:{default:0,description:"RAM usage (polled every minute)"},browser_files_size:{default:0,description:"Browser file size (polled every minute)"},downloads_size:{default:0,description:"Downloads size (polled every minute)"},battery_status:{default:"UNKNOWN",description:"Battery status: CHARGING, DISCHARGING, UNKNOWN"},battery_level_percent:{default:100,description:"Battery level 0-100"},battery_saver_enabled:{default:0,description:"Whether the battery saver feature is enabled"},battery_saver_is_saving_now:{default:0,description:"Whether the battery saver is saving power"},battery_saver_auto_on_enabled:{default:0,description:"Whether the battery saver turns on automatically"}}},312:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabChangedEventSource=void 0;class a{constructor(e,t,a,s){this.fireEvent=e,this.onTabActivated=t,this.tabsGetFunction=a,this.variableStore=s}static registerVariables(e){e.registerStringVariable("last_navigation",this.VARIABLES.last_navigation.default)}async listener(e){const t=await new Promise((t=>this.tabsGetFunction(e.tabId,t)));await this.variableStore.setString("last_navigation",t.url),this.fireEvent({eventName:a.EVENT_SOURCE_NAME,windowId:e.windowId})}async activate(){this.listenerObject=this.listener.bind(this),this.onTabActivated.addListener(this.listenerObject)}async deactivate(){this.onTabActivated.removeListener(this.listenerObject),this.listenerObject=null}}t.TabChangedEventSource=a,a.VARIABLES={last_navigation:{default:"none",description:"Last navigated url"}},a.EVENT_SOURCE_NAME="tab-changed"},86:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryPatches=void 0;class a{constructor(){opr.browserSidebarPrivate&&opr.browserSidebarPrivate.onItemExpanded&&opr.browserSidebarPrivate.onItemExpanded.addListener(this.onItemExpanded)}onItemExpanded(e){e===a.LASTCARD_ID&&chrome.runtime.sendMessage(a.LASTCARD_ID,{type:"ToggleRedDot",data:!1})}}a.LASTCARD_ID="niedpkpgcoojodjamdaecieijchonfnm",t.TemporaryPatches=class{constructor(){this.lastpass=new a}}},482:(e,t)=>{function a(){return Math.floor((+new Date-+new Date("1601-01-01 00:00:00 UTC"))/36e5)}Object.defineProperty(t,"__esModule",{value:!0}),t.UiVariableCollector=void 0;class s{constructor(e){this.variableStore=e,this.windowObservers=new Map}static isAvailable(){return void 0!==opr.uiTrackerPrivate}static registerVariables(e){e.registerIntVariable("vpn_badge_interaction_timestamp",this.VARIABLES.vpn_badge_interaction_timestamp.default),e.registerIntVariable("vpn_enabled",this.VARIABLES.vpn_enabled.default),e.registerIntVariable("vpn_enabled_timestamp",this.VARIABLES.vpn_enabled_timestamp.default)}observeWindow(e){if(this.windowObservers.has(e.id))throw new Error("Window already observed");const t={vpnMouseObserver:(e,t)=>this.onVpnMouseAction(e,t),vpnStateObserver:(e,t)=>this.onVpnUiStateChanged(e,t)};this.windowObservers.set(e.id,t),opr.uiTrackerPrivate.onUiElementPropertyChanged.addListener(t.vpnStateObserver,e.id,"address_bar_vpn","UiState"),opr.uiTrackerPrivate.onUiElementAction.addListener(t.vpnMouseObserver,e.id,"address_bar_vpn","Mouse")}onWindowRemoved(e){this.windowObservers.delete(e)}onVpnMouseAction(e,t){t.error||"ET_MOUSE_RELEASED"===/[^\s]+/.exec(t.actionDetails)[0]&&this.variableStore.setInt("vpn_badge_interaction_timestamp",a())}onVpnUiStateChanged(e,t){if(t.error)return;const s=this.currentEnabledState;if(this.currentEnabledState="inactive"!==t.propertyValue&&"invisible"!==t.propertyValue,s!=this.currentEnabledState){const e=void 0===s,t=0===this.variableStore.getInt("vpn_enabled_timestamp");!this.currentEnabledState||e&&!t||this.variableStore.setInt("vpn_enabled_timestamp",a(),"dont_flush"),this.variableStore.setInt("vpn_enabled",this.currentEnabledState?1:0)}}async init(){const e=await new Promise((e=>chrome.windows.getAll({windowTypes:["normal"]},e)));chrome.windows.onCreated.addListener((e=>{"normal"===e.type&&this.observeWindow(e)})),chrome.windows.onRemoved.addListener((e=>this.onWindowRemoved(e))),e.forEach((e=>this.observeWindow(e)))}}t.UiVariableCollector=s,s.VARIABLES={vpn_badge_interaction_timestamp:{default:0,description:"Last interaction time with the VPN badge as a Webkit timestamp"},vpn_enabled:{default:0,description:"Current state of the VPN badge"},vpn_enabled_timestamp:{default:0,description:"Time when VPN was enabled as a Webkit timestamp"}}},379:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableRegistry=void 0,t.VariableRegistry=class{constructor(){this._variables=new Map}get variables(){return this._variables}registerIntVariable(e,t){this.variables.set(e,t)}registerStringVariable(e,t){this.variables.set(e,t)}}},768:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableStore=void 0;class a{constructor(e,t){this.storage=e,this.settings=t}static async saveInternal(e,t){await new Promise((a=>e.set(t,a)))}async setInt(e,t,a){if(!(e in this.settings.trigger_variables.int))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.int[e]=t,void 0!==a&&"flush"!==a||await this.save()}async setString(e,t,a){if(!(e in this.settings.trigger_variables.string))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.string[e]=t,void 0!==a&&"flush"!==a||await this.save()}getInt(e){const t=this.settings.trigger_variables.int[e];if(void 0===t)throw new Error("Variable not registered");return t}getString(e){const t=this.settings.trigger_variables.string[e];if(void 0===t)throw new Error("Variable not registered");return t}async save(){await a.saveInternal(this.storage,this.settings)}static async load(e,t){var s;const r={trigger_variables:null!==(s=(await new Promise((t=>e.get((e=>t(e)))))).trigger_variables)&&void 0!==s?s:{int:{},string:{}}};return["int","string"].forEach((e=>{const a=new Set;for(const s in r.trigger_variables[e])(()=>{const a=t.variables.get(s);return(void 0===a?"none":"string"==typeof a?"string":"int")!==e})()&&a.add(s);a.forEach((t=>{delete r.trigger_variables[e][t]}))})),t.variables.forEach(((e,t)=>{const a="string"==typeof e?"string":"int",s="string"==typeof e?"int":"string";t in r.trigger_variables[a]||(r.trigger_variables[a][t]=e),t in r.trigger_variables[s]&&delete r.trigger_variables[s][t]})),await a.saveInternal(e,r),new a(e,r)}}t.VariableStore=a}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,a),n.exports}(()=>{const e=a(778),t=a(175),s=a(888),r=a(71),n=a(312),i=a(952),o=a(130),c=a(379),d=a(768),l=a(854),h=a(603),u=a(932),g=a(839),p=a(987),v=a(793),m=a(977),b=a(220),w=a(919),_=a(727),E=a(278),A=a(86),S=a(498),f=a(365),C=a(482),y=a(254),T=a(150);document.errorReporter=new r.ErrorReporter,document.addEventListener("DOMContentLoaded",(async()=>{const a=new T.Constants(await T.Constants.getProductType()),r=new E.ExternalConnectionMessageParser,I=b.InjectionBasedPageApiManager.defaultServicedApiMap(r),M=new c.VariableRegistry;n.TabChangedEventSource.registerVariables(M),v.CashbackBadgeShownEventSource.registerVariables(M),b.InjectionBasedPageApiManager.registerVariables(M,I),w.ExtensionPromotions.registerVariables(M),s.Adblock.registerVariables(M);const L=await h.HistoryTagStorage.readHistoryTagsFromJson("history-tags.json");h.HistoryTagStorage.registerVariables(M,L),S.AgentClock.registerVariables(M),f.PerformanceVariableCollector.registerVariables(a,M),C.UiVariableCollector.isAvailable()&&C.UiVariableCollector.registerVariables(M),y.CheckoutPageEventSource.isAvailable()&&y.CheckoutPageEventSource.registerVariables(M);const P=await d.VariableStore.load(chrome.storage.local,M);I.forEach((e=>e.publishApiLevel(P)));const N=new _.ExternalConnectionBroker(r,_.defaultExternalConnectionPortFactory);document.injectionBasedPageApiManager=new b.InjectionBasedPageApiManager(N,r,I),document.extensionPromotions=new w.ExtensionPromotions(P),document.adblock=new s.Adblock(P);const R=await(0,m.checkExtensionLaunchType)(),O=new S.AgentClock(P);await O.init(R),document.performanceVariableCollector=new f.PerformanceVariableCollector(a,P,O),document.performanceVariableCollector.init(),C.UiVariableCollector.isAvailable()&&(document.uiVariableCollector=new C.UiVariableCollector(P),document.uiVariableCollector.init());const k=new Map;k.set(n.TabChangedEventSource.EVENT_SOURCE_NAME,(()=>new n.TabChangedEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onActivated,chrome.tabs.get,P))),k.set(i.ManyTabsEventSource.EVENT_SOURCE_NAME,(()=>new i.ManyTabsEventSource(document.performanceVariableCollector))),k.set(o.ManyTabsFlowEventSource.EVENT_SOURCE_NAME,(()=>new o.ManyTabsFlowEventSource(document.performanceVariableCollector))),v.CashbackBadgeShownEventSource.isAvailable()&&k.set(v.CashbackBadgeShownEventSource.EVENT_SOURCE_NAME,(()=>new v.CashbackBadgeShownEventSource(P))),y.CheckoutPageEventSource.isAvailable()&&k.set(y.CheckoutPageEventSource.EVENT_SOURCE_NAME,(()=>new y.CheckoutPageEventSource(P))),k.set(S.ClockEventSource.EVENT_SOURCE_NAME,(()=>new S.ClockEventSource(O)));const V=await h.HistoryTagStorage.load("history_tags",P),F=new l.HistoryTagUpdater(V,L,18e5),B=Date.now();for(const e of L){const t=await p.HistoryTagEventsBackend.make(p.HistoryTagEventsBackend.getDefaultStorageKey(e.tag),B,R,e.tag,F,V);k.set(u.BrowserLaunchedWithTagAssigned.eventNameForTag(e.tag),(()=>new u.BrowserLaunchedWithTagAssigned(t))),k.set(g.HistoryTagAssignedEventSource.eventNameForTag(e.tag),(()=>new g.HistoryTagAssignedEventSource(t)))}const W=new t.EventSourceFactoryImpl(k);document.eventRegistry=new e.EventRegistry(opr.richHintsAgentPrivate.onSpecificationUpdated,opr.richHintsAgentPrivate.provideEvents,W),document.patches=new A.TemporaryPatches,F.init(document.eventRegistry),document.eventRegistry.registerEvents()}),!1)})()})();